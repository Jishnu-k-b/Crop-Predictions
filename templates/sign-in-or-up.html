{% extends "base.html" %}

{% block content %}

<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css'>
<link rel="stylesheet" href="/static/css/sstyle.css">

<div class="container" id="container">
    <div class="form-container sign-up-container">
        <form action="register" method="POST" id="signup_form">
            <h1 class="h11">Create Account</h1>
            <input type="text" placeholder="First Name" id="first_name" name="first_name" required />
            <input type="text" placeholder="Last Name" id="last_name" name="last_name" required />
            <span id="age_error" class="error"></span>
            <input type="tel" placeholder="Phone Number" id="phone_number" name="phone_number" oninput="validatePhoneNumber()" minlength="10" required />
            <span id="phone_number_error" class="error"></span>
            <input type="email" placeholder="Email" id="email" name="email" required />
            <input type="password" placeholder="Password" id="password" name="password" required />
            <input type="password" placeholder="Confirm Password" id="confirm_password" name="confirm_password" required />
            <span id="password_error" class="error"></span>
            <div id="register-error-message"></div>
            {% if reg_error: %}
            <div id="register-error-message">
                <p><b>{{ reg_error }}</b></p>
            </div>
            {% endif %}
            <button class="sign" type="button" id="submit_button">Sign Up</button>
        </form>
    </div>
    <div class="form-container sign-in-container">
        <form action="/login" method="POST">
            <h1 class="h11">Sign in</h1>
            <input type="email" placeholder="Email" id="user_email" name="user_email" />
            <input type="password" placeholder="Password" id="user_password" name="user_password" />
            {% if login_error: %}
            <div id="login-error-message">
                <p><b>{{ login_error }}</b></p>
            </div>
            {% endif %}
            <button class="sign" type="submit">Sign In</button>
        </form>
    </div>
    <div class="overlay-container">
        <div class="overlay">
            <div class="overlay-panel overlay-left">
                <h1>Welcome Back!</h1>
                <p>Login to continue</p>
                <button class="ghost" id="signIn">Sign In</button>
            </div>
            <div class="overlay-panel overlay-right">
                <h1>Hello, Create a new account</h1>
                <p>Enter your details to create the account</p>
                <button class="ghost" id="signUp">Sign Up</button>
            </div>
        </div>
    </div>
</div>

<script src="/static/js/script.js"></script>

<script>
    document.getElementById("phone_number").addEventListener("input", validatePhoneNumber);
    document.getElementById("password").addEventListener("input", validatePassword);
    document.getElementById("confirm_password").addEventListener("input", validateConfirmPassword);

    function validatePhoneNumber() {
        var phoneInput = document.getElementById("phone_number");
        var phone = phoneInput.value;
        var phoneError = document.getElementById("phone_number_error");

        // Check if the input contains only numbers
        if (/^\d+$/.test(phone)) {
            // If the length is exactly 10, set the maxlength attribute to 10
            if (phone.length === 10) {
                phoneInput.setAttribute("maxlength", "10");
                phoneError.textContent = "";
            } else if (phone.length < 10) {
                // If the length is less than 10, display an error message
                phoneInput.removeAttribute("maxlength");
                phoneError.textContent = "Phone number must be at least 10 digits.";
            } else {
                // If the length is greater than 10, remove the maxlength attribute to allow typing
                phoneInput.removeAttribute("maxlength");
                phoneError.textContent = "";
            }
        } else {
            // If input contains non-numeric characters, display an error message
            phoneInput.value = phone.replace(/\D/g, ''); // Remove non-numeric characters from input
            phoneError.textContent = "Phone number must contain only numbers.";
        }
    }

    function validatePassword() {
        var password = document.getElementById("password").value;
        var passwordError = document.getElementById("password_error");

        // Password pattern to enforce at least one uppercase letter, one lowercase letter, one number, one special character, and a minimum length of 8 characters
        var passwordPattern = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*]).{8,}$/;

        if (!passwordPattern.test(password)) {
            passwordError.textContent = "Password must contain at least one uppercase letter, one lowercase letter, one number, one special character, and be at least 8 characters long.";
        } else {
            passwordError.textContent = "";
        }
    }

    function validateConfirmPassword() {
        var password = document.getElementById("password").value;
        var confirmPassword = document.getElementById("confirm_password").value;
        var passwordError = document.getElementById("password_error");

        if (password !== confirmPassword) {
            passwordError.textContent = "Passwords do not match.";
        } else {
            passwordError.textContent = "";
        }
    }

    document.getElementById("submit_button").addEventListener("click", function () {
        var phoneError = document.getElementById("phone_number_error").textContent;
        var passwordError = document.getElementById("password_error").textContent;

        // Check if any required field is empty
        var firstName = document.getElementById("first_name").value.trim();
        var phoneNumber = document.getElementById("phone_number").value.trim();
        var password = document.getElementById("password").value.trim();
        var confirmPassword = document.getElementById("confirm_password").value.trim();

        if (firstName === "" || phoneNumber === "" || password === "" || confirmPassword === "") {
            alert("Please fill in all required fields.");
            return; // Exit function if any field is empty
        }

        // If any error messages are not empty, show an alert
        if (phoneError !== "" || passwordError !== "") {
            alert("Please check the entered data.");
        } else {
            // Otherwise, submit the form
            document.getElementById("signup_form").submit();
        }
    });
</script>

{% endblock %}
